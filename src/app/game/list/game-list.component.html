<nav class="topnav"><!--
    -->
    <div style="float: left;"><!--
    -->
        <svg style="float: left; margin-top: 10px;" version="1.0" xmlns="http://www.w3.org/2000/svg"
             width="50px" height="50px" viewBox="0 0 20.000000 18.000000"
             preserveAspectRatio="xMidYMid meet">

            <g transform="translate(0.000000,18.000000) scale(0.100000,-0.100000)"
               fill="rgba(255,255,255,.2)" stroke="none">
                <path d="M22 157 c-12 -13 -22 -29 -22 -36 0 -7 11 1 24 16 13 15 28 25 32 21
4 -5 0 -16 -9 -26 -22 -24 -22 -57 1 -79 9 -10 17 -24 17 -32 0 -8 6 -16 13
-19 7 -2 10 2 6 12 -4 12 0 16 16 16 16 0 20 -4 16 -16 -4 -10 -1 -14 6 -12 7
3 13 11 13 19 0 8 8 22 18 31 22 23 22 56 0 80 -9 10 -13 21 -9 26 4 4 19 -6
32 -21 14 -16 24 -22 24 -14 0 7 -12 24 -26 38 l-26 24 -18 -22 c-23 -28 -41
-29 -58 -3 -16 26 -24 25 -50 -3z m68 -72 c0 -39 -14 -46 -30 -14 -14 25 -6
49 15 49 11 0 15 -10 15 -35z m56 21 c6 -17 -12 -56 -26 -56 -6 0 -10 16 -10
35 0 25 4 35 15 35 9 0 18 -6 21 -14z"/>
            </g>
        </svg><!--
    --><i routerLink="/login" routerLinkActive="active" class="hovicon fa fa-user"></i>
    </div><!--
    -->
    <div style="float: right; text-align: right;"><!--
    --><i class="hovicon fa fa-refresh" (click)="getGames()"
          [ngClass]="slimLoadingBarService.progress > 0 ? 'fa-spin' : ''"></i><!--
    --><i routerLink="/game/new" routerLinkActive="active" class="hovicon fa fa-plus"></i><!--
    --><i *ngIf="displayMode != 0" (click)="displayMode = 0" class="hovicon fa fa-th"></i><!--
    --><i *ngIf="displayMode != 1" (click)="displayMode = 1" class="hovicon fa fa-list"></i><!--
    --><i class="hovicon fa fa-search" (click)="displayFilters = !displayFilters"></i><!--
    -->
        <div class="input"><!--
    --><input type="text" id="name" name="name"
              [(ngModel)]="userGameFilter.game.name"
              #name="ngModel"
              autocomplete="off"
              placeholder="Recherche">
            <span class="bar"></span><!--
    --></div><!--
    -->
        <div class="input">
            <label for="orderField" style="font-size: 14px; margin: 0">Tri</label>
            <div style="width: 200px; display: inline-block;">
                <select id="orderField"
                        [(ngModel)]="orderField" name="orderField"
                        #name="ngModel">
                    <option *ngFor="let field of tableFields"
                            [value]="userGameFields[field].name">

                        {{ userGameFields[field].label }}
                    </option>
                </select>
            </div><!--
    --><i class="hovicon fa" (click)="orderOption = !orderOption"
          [ngClass]="orderOption ? 'fa-sort-amount-asc' : 'fa-sort-amount-desc'"></i><!--
    --></div><!--
    --></div><!--
-->
    <div class="filters" *ngIf="displayFilters" [ngClass]="displayFilters ? 'on' : ''" style="padding-bottom: 15px">
        <p-tabView>
            <p-tabPanel header="Général">
                <div class="row">
                    <div class="col-md-6">
                        <div>
                            <label for="name">Platforme</label><br>
                            <tag *ngFor="let platform of platformsTags;"
                                 [tag]="platform"
                                 [filter]="userGameFilter.platforms"
                                 [suffix]="platformsCount[platform.id]"
                                 (uploaded)="toggleTag('platforms', $event, platform)"></tag>
                        </div>
                        <div>
                            <label for="name">Mode</label><br>
                            <tag *ngFor="let mode of modesTags;"
                                 [tag]="mode"
                                 [filter]="userGameFilter.game.modes"
                                 [suffix]="modesCount[mode.id]"
                                 (uploaded)="toggleTag('modes', $event, mode)"></tag>
                        </div>
                        <div>
                            <label for="name">Thème</label><br>
                            <tag *ngFor="let theme of themesTags;"
                                 [tag]="theme"
                                 [filter]="userGameFilter.game.themes"
                                 [suffix]="themesCount[theme.id]"
                                 (uploaded)="toggleTag('themes', $event, theme)"></tag>
                        </div>
                        <div>
                            <label for="name">Genre</label><br>
                            <tag *ngFor="let genre of genresTags;"
                                 [tag]="genre"
                                 [filter]="userGameFilter.game.genres"
                                 [suffix]="genresCount[genre.id]"
                                 (uploaded)="toggleTag('genres', $event, genre)"></tag>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="name">Année Sortie ({{userGameFilter.releaseYearRange[0] + ' - ' +
                            userGameFilter.releaseYearRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.releaseYearRange" [range]="true"
                                  [min]="userGameFilter.minReleaseYear"
                                  [max]="userGameFilter.maxReleaseYear"></p-slider>

                        <label for="name">Note ({{userGameFilter.ratingRange[0] + ' - ' +
                            userGameFilter.ratingRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.ratingRange" [range]="true"
                                  [min]="userGameFilter.minRating"
                                  [max]="userGameFilter.maxRating"></p-slider>

                        <label for="name">Prix Payé ({{userGameFilter.pricePaidRange[0] + ' - ' +
                            userGameFilter.pricePaidRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.pricePaidRange" [range]="true"
                                  [min]="userGameFilter.minPrice"
                                  [max]="userGameFilter.maxPrice"></p-slider>

                        <label for="name">Prix Revente ({{userGameFilter.priceResaleRange[0] + ' - ' +
                            userGameFilter.priceResaleRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.priceResaleRange" [range]="true"
                                  [min]="userGameFilter.minPrice"
                                  [max]="userGameFilter.maxPrice"></p-slider>

                        <label for="name">Prix Vendu ({{userGameFilter.priceSoldRange[0] + ' - ' +
                            userGameFilter.priceSoldRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.priceSoldRange" [range]="true"
                                  [min]="userGameFilter.minPrice"
                                  [max]="userGameFilter.maxPrice"></p-slider>

                        <label for="name">Prix Demandé ({{userGameFilter.priceAskedRange[0] + ' - ' +
                            userGameFilter.priceAskedRange[1]}})</label><br>
                        <p-slider [(ngModel)]="userGameFilter.priceAskedRange" [range]="true"
                                  [min]="userGameFilter.minPrice"
                                  [max]="userGameFilter.maxPrice"></p-slider>
                    </div>
                    <div class="col-md-3">
                        <div>
                            <label>Version</label><br>
                            <tag [tag]="'FRA'" [filter]="userGameFilter.versions"
                                 (uploaded)="toggleTag('versions', $event, 'FRA')"></tag>
                            <tag [tag]="'EUR'" [filter]="userGameFilter.versions"
                                 (uploaded)="toggleTag('versions', $event, 'EUR')"></tag>
                            <tag [tag]="'FAH'" [filter]="userGameFilter.versions"
                                 (uploaded)="toggleTag('versions', $event, 'FAH')"></tag>
                        </div>
                        <div>
                            <label>Progression</label><br>
                            <tag [tag]="'Jamais joué'" [value]="0" [filter]="userGameFilter.progresses"
                                 (uploaded)="toggleTag('progresses', $event, 0)"></tag>
                            <tag [tag]="'En cours'" [value]="1" [filter]="userGameFilter.progresses"
                                 (uploaded)="toggleTag('progresses', $event, 1)"></tag>
                            <tag [tag]="'Terminé'" [value]="2" [filter]="userGameFilter.progresses"
                                 (uploaded)="toggleTag('progresses', $event, 2)"></tag>
                            <tag [tag]="'Abandonné'" [value]="3" [filter]="userGameFilter.progresses"
                                 (uploaded)="toggleTag('progresses', $event, 3)"></tag>
                        </div>
                        <div>
                            <label for="name">Lieu Achat</label><br>
                            <tag *ngFor="let place of purchasePlaceTags;"
                                 [tag]="place"
                                 [filter]="userGameFilter.purchasePlaces"
                                 [suffix]="purchasePlaceCount[place.id]"
                                 (uploaded)="toggleTag('purchasePlaces', $event, place)"></tag>
                        </div>
                        <div *ngIf="salePlaceTags.length > 0">
                            <label for="name">Lieu Vente</label><br>
                            <tag *ngFor="let place of salePlaceTags;"
                                 [tag]="place"
                                 [filter]="userGameFilter.salePlaces"
                                 [suffix]="salePlaceCount[place.id]"
                                 (uploaded)="toggleTag('salePlaces', $event, place)"></tag>
                        </div>
                    </div>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Développeur">
                <tag *ngFor="let developer of developersTags;"
                     [tag]="developer"
                     [filter]="userGameFilter.game.developers"
                     [suffix]="developersCount[developer.id]"
                     (uploaded)="toggleTag('developers', $event, developer)"></tag>
            </p-tabPanel>
            <p-tabPanel header="Éditeur">
                <tag *ngFor="let publisher of publishersTags;"
                     [tag]="publisher"
                     [filter]="userGameFilter.game.publishers"
                     [suffix]="publishersCount[publisher.id]"
                     (uploaded)="toggleTag('publishers', $event, publisher)"></tag>
            </p-tabPanel>
            <p-tabPanel header="Vendeur">
                <tag *ngFor="let contact of purchaseContactTags;"
                     [tag]="contact | formatName"
                     [filter]="userGameFilter.purchaseContacts"
                     [suffix]="purchaseContactCount[contact.id]"
                     (uploaded)="toggleTag('purchaseContacts', $event, contact)"></tag>
            </p-tabPanel>
            <p-tabPanel header="Acheteur" *ngIf="saleContactTags.length > 0">
                <tag *ngFor="let contact of saleContactTags;"
                     [tag]="contact | formatName"
                     [filter]="userGameFilter.saleContacts"
                     [suffix]="saleContactCount[contact.id]"
                     (uploaded)="toggleTag('saleContacts', $event, contact)"></tag>
            </p-tabPanel>
        </p-tabView>
    </div>
    <!--
    -->
</nav>


<div #gameBanner class="gameBanner gameBannerBig">
    <section *ngFor="let userGame of userGames | filter: userGameFilter | orderBy: orderField:orderOption;
     let i = index;">
        <div class="gameBannerBg" *ngIf="i == 0 && userGame.game.screenshots && userGame.game.screenshots.length > 0"
             [style.margin-left]="bannerMarginLeft+'px'"
             [style.width]="bannerWidth+'px'"
             [style.height]="bannerHeight+'px'"
             [style.background-image]="'url(http://images.igdb.com/igdb/image/upload/t_screenshot_huge/' + userGame.game.screenshots[0].cloudinaryId + '.jpg)' | safe: 'style'"></div>
        <div class="gameBannerBg"
             *ngIf="i == 0 && (!userGame.game.screenshots || userGame.game.screenshots.length == 0)"></div>

    </section>
</div>


<div class="title">
    Mes Jeux

    <table class="table">
        <tbody>
        <tr>
            <td></td>
            <td class="tdLabel"></td>
            <td class="tdLabel">prix payé</td>
            <td class="tdLabel">prix de vente</td>
        </tr>
        <tr>
            <td class="tdLabel">TOTAL</td>
            <td>{{ userGames.length }} jeux</td>
            <td>???? €</td>
            <td>???? €</td>
        </tr>
        <tr>
            <td class="tdLabel">RECHERCHE</td>
            <td>{{ userGames | filter: userGameFilter | length }} jeux ({{ ((userGames | filter: userGameFilter |
                length) * 100 / userGames.length) | number:'2.0-0' }}%)
            </td>
            <td>???? € (??%)</td>
            <td>???? € (??%)</td>
        </tr>
        </tbody>
    </table>
</div>

<div *ngIf="displayMode == 1">

    <table class="table">
        <tr>
            <th></th>
            <th *ngFor="let field of tableFields"
                (click)="setOrderField(field)"
                [ngClass]="userGameFields[field].hiddenMD ? 'hidden-md hidden-sm hidden-xs' : ''">

                <span *ngIf="field != 'progress'">{{ userGameFields[field].label }}</span>
                <i class="fa" *ngIf="orderField == field"
                   [ngClass]="orderOption ? 'fa-sort-asc' : 'fa-sort-desc'"></i>
                <i class="fa fa-sort-asc" style="visibility: hidden" *ngIf="orderField != field"></i>
            </th>
        </tr>
        <tr *ngFor="let userGame of userGames | filter: userGameFilter | orderBy: orderField:orderOption;"
            (click)="selectUserGame(userGame)">

            <td [style.background-image]="'url(http://images.igdb.com/igdb/image/upload/t_cover_big/' + userGame.game.cover.cloudinaryId + '.jpg)' | safe: 'style'"></td>

            <td *ngFor="let field of tableFields"
                [ngClass]="userGameFields[field].hiddenMD ? 'hidden-md hidden-sm hidden-xs' : ''">

                <span *ngIf="field != 'progress'">{{ userGame | userGameValue: userGameFields[field] }}</span>
                <div *ngIf="field == 'progress'" class="gameProgress"
                     [ngClass]="'gameProgress'+userGame.progress"></div>
            </td>
        </tr>
    </table>
</div>
<div *ngIf="displayMode == 0">

    <section *ngFor="let userGame of userGames | filter: userGameFilter | orderBy: orderField:orderOption;"
             (click)="selectUserGame(userGame)"
             class="gameBox visible_anim">
        <!--routerLink="/game/{{userGame.platform.slug}}/{{userGame.game.slug}}"-->
        <!--in-viewport (inViewport)="setItemClass($event)"-->
        <div class="gameCover" *ngIf="userGame.game.cover"
             [style.background-image]="'url(http://images.igdb.com/igdb/image/upload/t_cover_big/' + userGame.game.cover.cloudinaryId + '.jpg)' | safe: 'style'"></div>
        <div class=gameInfos>
            <div class="gameTitle" [innerHTML]="userGame.game | formatName:true"></div>

            <div class="row">
                <div class="col-md-12">
                    {{ userGame.platform.name }}
                    <br>
                    <span *ngIf="userGame.game.developers[0]">{{ userGame.game.developers[0].name }}</span>
                    <br>
                    {{ userGame.version }}
                    <span *ngIf="userGame.box && userGame.manual">Complet</span>
                    <span *ngIf="userGame.box && !userGame.manual">Boîte sans livret</span>
                    <span *ngIf="!userGame.box && userGame.manual">Livret sans boîte</span>
                    <span *ngIf="!userGame.box && !userGame.manual">Loose</span>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    Demandé {{ userGame.priceAsked }}€
                </div>
                <div class="col-md-6">
                    Payé {{ userGame.pricePaid }}€
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    Revente {{ userGame.priceResale }}€
                </div>
                <div class="col-md-6">
                    Vendu {{ userGame.priceSold }}€
                </div>
            </div>
        </div>
    </section>
</div>

<game-detail [userGame]="selectedUserGame" *ngIf="selectedUserGame">
    <div class="topnav"><!--
    -->
        <div class="navRight"><i class="hovicon fa fa-close" (click)="selectUserGame(null)"></i></div><!--
        --><i *ngIf="prevUserGame" class="hovicon fa fa-step-backward" (click)="selectUserGame(prevUserGame)"></i><!--
        --><i *ngIf="nextUserGame" class="hovicon fa fa-step-forward" (click)="selectUserGame(nextUserGame)"></i><!--
    --> </div>
</game-detail>